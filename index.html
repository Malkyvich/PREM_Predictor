<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rugby Premiership Predictor 2025/26</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4845b8'
                    }
                }
            }
        }
    </script>
    <style>
        .prediction-card {
            transition: all 0.3s ease;
        }
        .prediction-card:hover {
            transform: translateY(-2px);
        }
        .completed-match {
            opacity: 0.7;
        }
        .winner-highlight {
            background: linear-gradient(45deg, #10b981, #059669);
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .pending-prediction {
            border-left: 4px solid #f59e0b;
        }
        .submitted-prediction {
            border-left: 4px solid #10b981;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent">
                üèâ Rugby Premiership Predictor
            </h1>
            <p class="text-lg text-gray-600 dark:text-gray-400">Season 2025/26 ‚Ä¢ 3 Player Championship</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex flex-wrap justify-center mb-6 border-b border-gray-200 dark:border-gray-700">
            <button onclick="showTab('leaderboard')" id="tab-leaderboard" class="tab-button px-6 py-3 font-medium border-b-2 border-primary text-primary">
                üèÜ Leaderboard
            </button>
            <button onclick="showTab('predictions')" id="tab-predictions" class="tab-button px-6 py-3 font-medium border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                üìä Predictions
            </button>
            <button onclick="showTab('fixtures')" id="tab-fixtures" class="tab-button px-6 py-3 font-medium border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                üìÖ Fixtures
            </button>
            <button onclick="showTab('results')" id="tab-results" class="tab-button px-6 py-3 font-medium border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                ‚úÖ Enter Results
            </button>
        </div>

        <!-- Leaderboard Tab -->
        <div id="leaderboard-tab" class="tab-content">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6 mb-6">
                <h2 class="text-2xl font-bold mb-4">üèÜ Championship Leaderboard</h2>
                <div id="leaderboard-content" class="space-y-3">
                    <!-- Leaderboard will be populated here -->
                </div>
            </div>
            
            <!-- Points System Explanation -->
            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                <h3 class="font-bold mb-2">üìã Weekly Ranking System</h3>
                <ul class="text-sm space-y-1">
                    <li><strong>Match Points:</strong> Exact Score (5pts) ‚Ä¢ Correct Result + Margin ‚â§3 (3pts) ‚Ä¢ Correct Result (1pt) ‚Ä¢ Wrong (0pts)</li>
                    <li><strong>Weekly Ranking:</strong> Total match points per Game Week, with accuracy as tiebreaker</li>
                    <li><strong>Season Points:</strong> 1st place = 3pts ‚Ä¢ 2nd place = 2pts ‚Ä¢ 3rd place = 1pt</li>
                    <li><strong>Accuracy Score:</strong> Average margin difference (lower = better) ‚Ä¢ Wrong winners get negative accuracy</li>
                </ul>
            </div>
        </div>

        <!-- Predictions Tab -->
        <div id="predictions-tab" class="tab-content hidden">
            <div class="mb-4 flex flex-wrap gap-4 items-center justify-between">
                <div class="flex-1 min-w-[200px]">
                    <label for="player-select" class="block text-sm font-medium mb-2">Select Player:</label>
                    <select id="player-select" class="w-full md:w-64 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-base">
                        <option value="player1">Martin</option>
                        <option value="player2">Charles</option>
                        <option value="player3">Alex</option>
                    </select>
                </div>
                <button onclick="submitPendingPredictions()" id="submit-predictions-btn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium shadow-lg hidden">
                    üì§ Submit Predictions
                </button>
            </div>
            <div id="pending-count" class="mb-4 hidden">
                <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3 text-sm">
                    <strong class="text-yellow-800 dark:text-yellow-200">‚ö†Ô∏è Pending predictions:</strong> 
                    <span id="pending-number" class="font-bold">0</span> predictions not yet submitted
                </div>
            </div>
            <div id="predictions-content" class="grid gap-4">
                <!-- Predictions will be populated here -->
            </div>
        </div>

        <!-- Fixtures Tab -->
        <div id="fixtures-tab" class="tab-content hidden">
            <div class="mb-4 flex flex-wrap gap-3">
                <button onclick="addFixture()" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-lg font-medium">
                    ‚ûï Add Fixture
                </button>
                <button onclick="resetAllData()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium">
                    üóëÔ∏è Reset All Data
                </button>
            </div>
            <div id="fixtures-content" class="space-y-4">
                <!-- Fixtures will be populated here -->
            </div>
        </div>

        <!-- Results Tab -->
        <div id="results-tab" class="tab-content hidden">
            <div class="mb-4">
                <h2 class="text-2xl font-bold mb-2">Enter Match Results</h2>
                <p class="text-gray-600 dark:text-gray-400">Enter actual scores to calculate points and update the leaderboard.</p>
            </div>
            <div id="results-content" class="space-y-4">
                <!-- Results entry will be populated here -->
            </div>
        </div>
    </div>

    <!-- Add Fixture Modal -->
    <div id="fixture-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4">
            <h3 class="text-lg font-bold mb-4">Add New Fixture</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Home Team:</label>
                    <select id="home-team" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-base">
                        <!-- Teams will be populated -->
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Away Team:</label>
                    <select id="away-team" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-base">
                        <!-- Teams will be populated -->
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Match Date:</label>
                    <input type="date" id="match-date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-base">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Round:</label>
                    <input type="text" id="match-round" placeholder="e.g., Round 1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-base">
                </div>
                <div class="flex justify-end space-x-3">
                    <button onclick="closeFixtureModal()" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
                        Cancel
                    </button>
                    <button onclick="saveFixture()" class="px-4 py-2 bg-primary text-white hover:bg-primary-dark rounded">
                        Add Fixture
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark mode setup
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Premiership teams
        const teams = [
            'Bath', 'Bristol Bears', 'Exeter', 'Gloucester',
            'Harlequins', 'Leicester Tigers', 'Newcastle Red Bulls', 'Northampton',
            'Sale Sharks', 'Saracens'
        ];

        // Data storage
        let fixtures = [];
        let predictions = {
            player1: { submitted: {}, pending: {} },
            player2: { submitted: {}, pending: {} },
            player3: { submitted: {}, pending: {} }
        };
        let results = {};
        let playerNames = {
            player1: 'Martin',
            player2: 'Charles', 
            player3: 'Alex'
        };

        // Load data from storage
        function loadFromStorage() {
            try {
                const savedFixtures = JSON.parse(window.localStorage.getItem('rugbyFixtures') || '[]');
                const savedPredictions = JSON.parse(window.localStorage.getItem('rugbyPredictions') || '{}');
                const savedResults = JSON.parse(window.localStorage.getItem('rugbyResults') || '{}');
                const savedPlayerNames = JSON.parse(window.localStorage.getItem('rugbyPlayerNames') || '{}');

                if (savedFixtures.length > 0) {
                    fixtures = savedFixtures;
                    predictions = savedPredictions;
                    results = savedResults;
                    if (Object.keys(savedPlayerNames).length > 0) {
                        playerNames = savedPlayerNames;
                    }
                    return true;
                }
            } catch (e) {
                console.error('Error loading from storage:', e);
            }
            return false;
        }

        // Save data to storage
        function saveToStorage() {
            try {
                window.localStorage.setItem('rugbyFixtures', JSON.stringify(fixtures));
                window.localStorage.setItem('rugbyPredictions', JSON.stringify(predictions));
                window.localStorage.setItem('rugbyResults', JSON.stringify(results));
                window.localStorage.setItem('rugbyPlayerNames', JSON.stringify(playerNames));
            } catch (e) {
                console.error('Error saving to storage:', e);
                showToast('‚ö†Ô∏è Error saving data', 'error');
            }
        }

        // Initialize with REAL 2025-26 Gallagher PREM Rugby fixtures
        function initializeSampleData() {
            fixtures = [
                // ROUND 1 - September 20-21, 2025
                { id: 1, homeTeam: 'Northampton', awayTeam: 'Exeter', date: '2025-09-20', round: 'Round 1', completed: false },
                { id: 2, homeTeam: 'Sale Sharks', awayTeam: 'Bath', date: '2025-09-20', round: 'Round 1', completed: false },
                { id: 3, homeTeam: 'Saracens', awayTeam: 'Gloucester', date: '2025-09-20', round: 'Round 1', completed: false },
                { id: 4, homeTeam: 'Leicester Tigers', awayTeam: 'Newcastle Red Bulls', date: '2025-09-21', round: 'Round 1', completed: false },
                { id: 5, homeTeam: 'Bristol Bears', awayTeam: 'Harlequins', date: '2025-09-21', round: 'Round 1', completed: false },

                // ROUND 2 - September 27-28, 2025
                { id: 6, homeTeam: 'Bath', awayTeam: 'Northampton', date: '2025-09-27', round: 'Round 2', completed: false },
                { id: 7, homeTeam: 'Exeter', awayTeam: 'Saracens', date: '2025-09-27', round: 'Round 2', completed: false },
                { id: 8, homeTeam: 'Newcastle Red Bulls', awayTeam: 'Bristol Bears', date: '2025-09-27', round: 'Round 2', completed: false },
                { id: 9, homeTeam: 'Gloucester', awayTeam: 'Leicester Tigers', date: '2025-09-28', round: 'Round 2', completed: false },
                { id: 10, homeTeam: 'Harlequins', awayTeam: 'Sale Sharks', date: '2025-09-28', round: 'Round 2', completed: false },

                // ROUND 3 - October 4-5, 2025
                { id: 11, homeTeam: 'Sale Sharks', awayTeam: 'Exeter', date: '2025-10-04', round: 'Round 3', completed: false },
                { id: 12, homeTeam: 'Bristol Bears', awayTeam: 'Bath', date: '2025-10-04', round: 'Round 3', completed: false },
                { id: 13, homeTeam: 'Saracens', awayTeam: 'Northampton', date: '2025-10-04', round: 'Round 3', completed: false },
                { id: 14, homeTeam: 'Leicester Tigers', awayTeam: 'Harlequins', date: '2025-10-05', round: 'Round 3', completed: false },
                { id: 15, homeTeam: 'Newcastle Red Bulls', awayTeam: 'Gloucester', date: '2025-10-05', round: 'Round 3', completed: false },

                // ROUND 4 - October 18-19, 2025
                { id: 16, homeTeam: 'Northampton', awayTeam: 'Sale Sharks', date: '2025-10-18', round: 'Round 4', completed: false },
                { id: 17, homeTeam: 'Gloucester', awayTeam: 'Bristol Bears', date: '2025-10-18', round: 'Round 4', completed: false },
                { id: 18, homeTeam: 'Bath', awayTeam: 'Leicester Tigers', date: '2025-10-18', round: 'Round 4', completed: false },
                { id: 19, homeTeam: 'Exeter', awayTeam: 'Harlequins', date: '2025-10-19', round: 'Round 4', completed: false },
                { id: 20, homeTeam: 'Saracens', awayTeam: 'Newcastle Red Bulls', date: '2025-10-19', round: 'Round 4', completed: false },

                // ROUND 5 - October 25-26, 2025
                { id: 21, homeTeam: 'Sale Sharks', awayTeam: 'Saracens', date: '2025-10-25', round: 'Round 5', completed: false },
                { id: 22, homeTeam: 'Harlequins', awayTeam: 'Bath', date: '2025-10-25', round: 'Round 5', completed: false },
                { id: 23, homeTeam: 'Leicester Tigers', awayTeam: 'Exeter', date: '2025-10-25', round: 'Round 5', completed: false },
                { id: 24, homeTeam: 'Bristol Bears', awayTeam: 'Northampton', date: '2025-10-26', round: 'Round 5', completed: false },
                { id: 25, homeTeam: 'Newcastle Red Bulls', awayTeam: 'Gloucester', date: '2025-10-26', round: 'Round 5', completed: false }
            ];

            // Initialize prediction structure
            predictions = {
                player1: { submitted: {}, pending: {} },
                player2: { submitted: {}, pending: {} },
                player3: { submitted: {}, pending: {} }
            };

            saveToStorage();
        }

        // Tab navigation
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('border-primary', 'text-primary');
                btn.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
            });

            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).classList.add('border-primary', 'text-primary');
            document.getElementById(`tab-${tabName}`).classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');

            if (tabName === 'leaderboard') updateLeaderboard();
            if (tabName === 'predictions') updatePredictionsView();
            if (tabName === 'fixtures') updateFixturesView();
            if (tabName === 'results') updateResultsView();
        }

        // Calculate points for a prediction
        function calculatePoints(prediction, actual) {
            if (!prediction || !actual) return 0;

            const predHome = parseInt(prediction.homeScore);
            const predAway = parseInt(prediction.awayScore);
            const actualHome = parseInt(actual.homeScore);
            const actualAway = parseInt(actual.awayScore);

            if (predHome === actualHome && predAway === actualAway) {
                return 5;
            }

            const predResult = predHome > predAway ? 'home' : (predHome < predAway ? 'away' : 'draw');
            const actualResult = actualHome > actualAway ? 'home' : (actualHome < actualAway ? 'away' : 'draw');

            if (predResult === actualResult) {
                const predMargin = Math.abs(predHome - predAway);
                const actualMargin = Math.abs(actualHome - actualAway);
                const marginDiff = Math.abs(predMargin - actualMargin);
                
                if (marginDiff <= 3) {
                    return 3;
                }
                return 1;
            }

            return 0;
        }

        // Calculate accuracy score
        function calculateAccuracy(prediction, actual) {
            if (!prediction || !actual) return null;

            const predHome = parseInt(prediction.homeScore);
            const predAway = parseInt(prediction.awayScore);
            const actualHome = parseInt(actual.homeScore);
            const actualAway = parseInt(actual.awayScore);

            const predResult = predHome > predAway ? 'home' : (predHome < predAway ? 'away' : 'draw');
            const actualResult = actualHome > actualAway ? 'home' : (actualHome < actualAway ? 'away' : 'draw');

            if (predResult !== actualResult) {
                return -Math.abs(Math.abs(predHome - predAway) - Math.abs(actualHome - actualAway));
            }

            const predMargin = Math.abs(predHome - predAway);
            const actualMargin = Math.abs(actualHome - actualAway);
            return Math.abs(predMargin - actualMargin);
        }

        // Calculate weekly rankings and season points
        function calculateWeeklyRankings() {
            const weeklyResults = {};
            const seasonTotals = {};

            Object.keys(playerNames).forEach(playerId => {
                seasonTotals[playerId] = {
                    name: playerNames[playerId],
                    seasonPoints: 0,
                    weeksWon: 0,
                    weeksSecond: 0,
                    weeksThird: 0,
                    weeklyHistory: []
                };
            });

            const fixturesByRound = {};
            fixtures.forEach(fixture => {
                if (fixture.completed && results[fixture.id]) {
                    const round = fixture.round || 'Other';
                    if (!fixturesByRound[round]) fixturesByRound[round] = [];
                    fixturesByRound[round].push(fixture);
                }
            });

            Object.keys(fixturesByRound).forEach(round => {
                const roundFixtures = fixturesByRound[round];
                const weeklyStats = {};

                Object.keys(playerNames).forEach(playerId => {
                    weeklyStats[playerId] = {
                        name: playerNames[playerId],
                        weeklyPoints: 0,
                        predictions: 0,
                        accuracyScores: []
                    };
                });

                roundFixtures.forEach(fixture => {
                    Object.keys(predictions).forEach(playerId => {
                        const prediction = predictions[playerId].submitted[fixture.id];
                        if (prediction) {
                            weeklyStats[playerId].predictions++;
                            weeklyStats[playerId].weeklyPoints += calculatePoints(prediction, results[fixture.id]);
                            
                            const accuracy = calculateAccuracy(prediction, results[fixture.id]);
                            if (accuracy !== null) {
                                weeklyStats[playerId].accuracyScores.push(accuracy);
                            }
                        }
                    });
                });

                Object.keys(weeklyStats).forEach(playerId => {
                    const stats = weeklyStats[playerId];
                    if (stats.accuracyScores.length > 0) {
                        stats.averageAccuracy = stats.accuracyScores.reduce((sum, acc) => sum + acc, 0) / stats.accuracyScores.length;
                    } else {
                        stats.averageAccuracy = 999;
                    }
                });

                const weeklyRanking = Object.values(weeklyStats)
                    .filter(stats => stats.predictions > 0)
                    .sort((a, b) => {
                        if (b.weeklyPoints === a.weeklyPoints) {
                            return a.averageAccuracy - b.averageAccuracy;
                        }
                        return b.weeklyPoints - a.weeklyPoints;
                    });

                weeklyRanking.forEach((player, index) => {
                    const playerId = Object.keys(playerNames).find(id => playerNames[id] === player.name);
                    const position = index + 1;
                    
                    let seasonPoints = 0;
                    if (position === 1) {
                        seasonPoints = 3;
                        seasonTotals[playerId].weeksWon++;
                    } else if (position === 2) {
                        seasonPoints = 2;
                        seasonTotals[playerId].weeksSecond++;
                    } else if (position === 3) {
                        seasonPoints = 1;
                        seasonTotals[playerId].weeksThird++;
                    }

                    seasonTotals[playerId].seasonPoints += seasonPoints;
                    seasonTotals[playerId].weeklyHistory.push({
                        round,
                        position,
                        weeklyPoints: player.weeklyPoints,
                        accuracy: player.averageAccuracy.toFixed(2),
                        seasonPoints
                    });
                });

                weeklyResults[round] = weeklyRanking;
            });

            return { weeklyResults, seasonTotals };
        }

        // Update leaderboard
        function updateLeaderboard() {
            const { weeklyResults, seasonTotals } = calculateWeeklyRankings();

            const sortedPlayers = Object.values(seasonTotals).sort((a, b) => b.seasonPoints - a.seasonPoints);

            const seasonLeaderboardHtml = sortedPlayers.map((player, index) => {
                const position = index + 1;
                const isWinner = position === 1 && player.seasonPoints > 0;
                
                return `
                    <div class="flex items-center justify-between p-4 rounded-lg border ${isWinner ? 'winner-highlight text-white' : 'bg-white dark:bg-gray-700 border-gray-200 dark:border-gray-600'}">
                        <div class="flex items-center space-x-4">
                            <div class="text-2xl font-bold ${isWinner ? 'text-yellow-300' : 'text-gray-500'}">
                                ${position === 1 ? 'ü•á' : position === 2 ? 'ü•à' : position === 3 ? 'ü•â' : `#${position}`}
                            </div>
                            <div>
                                <div class="font-bold text-lg">${player.name}</div>
                                <div class="text-sm ${isWinner ? 'text-gray-200' : 'text-gray-500 dark:text-gray-400'}">
                                    ${player.weeksWon}W ‚Ä¢ ${player.weeksSecond}√ó 2nd ‚Ä¢ ${player.weeksThird}√ó 3rd
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold">${player.seasonPoints}</div>
                            <div class="text-sm ${isWinner ? 'text-gray-200' : 'text-gray-500 dark:text-gray-400'}">
                                Season Points
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            const weeklyResultsHtml = Object.keys(weeklyResults).reverse().map(round => {
                const weekResults = weeklyResults[round];
                
                const weekHtml = weekResults.map((player, index) => {
                    const position = index + 1;
                    const seasonPointsEarned = position === 1 ? 3 : position === 2 ? 2 : position === 3 ? 1 : 0;
                    
                    return `
                        <div class="flex justify-between items-center py-2 px-3 rounded ${position === 1 ? 'bg-yellow-50 dark:bg-yellow-900/20' : position === 2 ? 'bg-gray-50 dark:bg-gray-700/50' : position === 3 ? 'bg-orange-50 dark:bg-orange-900/20' : 'bg-gray-25 dark:bg-gray-800/30'}">
                            <div class="flex items-center space-x-3">
                                <span class="font-bold text-lg">${position === 1 ? 'ü•á' : position === 2 ? 'ü•à' : position === 3 ? 'ü•â' : `#${position}`}</span>
                                <span class="font-medium">${player.name}</span>
                            </div>
                            <div class="text-right text-sm">
                                <div class="font-bold">${player.weeklyPoints} pts ‚Ä¢ ${seasonPointsEarned} season pts</div>
                                <div class="text-gray-500 dark:text-gray-400">Accuracy: ${player.averageAccuracy.toFixed(1)}</div>
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="mb-6">
                        <h4 class="font-bold text-lg mb-3 text-primary">${round} Results</h4>
                        <div class="space-y-2">
                            ${weekHtml}
                        </div>
                    </div>
                `;
            }).join('');

            const leaderboardContent = `
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4">üèÜ Season Championship</h3>
                    <div class="space-y-3">
                        ${seasonLeaderboardHtml}
                    </div>
                </div>
                ${weeklyResultsHtml ? `
                    <div>
                        <h3 class="text-xl font-bold mb-4">üìÖ Weekly Results</h3>
                        ${weeklyResultsHtml}
                    </div>
                ` : ''}
            `;

            document.getElementById('leaderboard-content').innerHTML = leaderboardContent || '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No predictions made yet. Make some predictions to see the leaderboard!</p>';
        }

        // Update predictions view
        function updatePredictionsView() {
            const selectedPlayer = document.getElementById('player-select').value;
            const playerPredictions = predictions[selectedPlayer];

            const fixturesByRound = {};
            fixtures.forEach(fixture => {
                const round = fixture.round || 'Other';
                if (!fixturesByRound[round]) fixturesByRound[round] = [];
                fixturesByRound[round].push(fixture);
            });

            const predictionsHtml = Object.keys(fixturesByRound).map(round => {
                const roundFixtures = fixturesByRound[round];
                const fixturesHtml = roundFixtures.map(fixture => {
                    const submittedPrediction = playerPredictions.submitted[fixture.id];
                    const pendingPrediction = playerPredictions.pending[fixture.id];
                    const prediction = submittedPrediction || pendingPrediction || {};
                    const isSubmitted = !!submittedPrediction;
                    const isPending = !!pendingPrediction && !submittedPrediction;
                    const isCompleted = fixture.completed;
                    const actualResult = results[fixture.id];
                    const points = isCompleted && actualResult && submittedPrediction ? calculatePoints(submittedPrediction, actualResult) : null;

                    return `
                        <div class="prediction-card bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 ${isCompleted ? 'completed-match' : ''} ${isPending ? 'pending-prediction' : ''} ${isSubmitted && !isCompleted ? 'submitted-prediction' : ''}">
                            <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-3">
                                <div class="font-bold text-lg mb-2 sm:mb-0">
                                    ${fixture.homeTeam} vs ${fixture.awayTeam}
                                </div>
                                <div class="flex flex-col items-end">
                                    <div class="text-sm text-gray-500 dark:text-gray-400">
                                        ${new Date(fixture.date).toLocaleDateString()}
                                    </div>
                                    ${isCompleted ? '<span class="text-xs bg-gray-500 text-white px-2 py-1 rounded mt-1">COMPLETED</span>' : ''}
                                    ${isSubmitted && !isCompleted ? '<span class="text-xs bg-green-500 text-white px-2 py-1 rounded mt-1">‚úì SUBMITTED</span>' : ''}
                                    ${isPending ? '<span class="text-xs bg-yellow-500 text-white px-2 py-1 rounded mt-1">‚ö† PENDING</span>' : ''}
                                </div>
                            </div>
                            
                            ${isCompleted && submittedPrediction ? `
                                <div class="mb-3 p-2 bg-gray-100 dark:bg-gray-700 rounded">
                                    <div class="text-sm font-medium mb-1">Your Prediction vs Actual Result:</div>
                                    <div class="flex justify-between">
                                        <span>Predicted: ${submittedPrediction.homeScore} - ${submittedPrediction.awayScore}</span>
                                        <span>Actual: ${actualResult.homeScore} - ${actualResult.awayScore}</span>
                                    </div>
                                    ${points !== null ? `<div class="font-bold text-primary mt-1">Points earned: ${points}</div>` : ''}
                                </div>
                            ` : ''}

                            <div class="flex space-x-4 items-center">
                                <div class="flex-1">
                                    <label class="block text-sm font-medium mb-1">${fixture.homeTeam}</label>
                                    <input type="number" min="0" max="100" 
                                           value="${prediction.homeScore || ''}"
                                           onchange="updatePrediction('${selectedPlayer}', ${fixture.id}, 'homeScore', this.value)"
                                           ${isCompleted || isSubmitted ? 'disabled' : ''}
                                           class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-base ${isCompleted || isSubmitted ? 'opacity-50' : ''}">
                                </div>
                                <div class="text-xl font-bold">-</div>
                                <div class="flex-1">
                                    <label class="block text-sm font-medium mb-1">${fixture.awayTeam}</label>
                                    <input type="number" min="0" max="100" 
                                           value="${prediction.awayScore || ''}"
                                           onchange="updatePrediction('${selectedPlayer}', ${fixture.id}, 'awayScore', this.value)"
                                           ${isCompleted || isSubmitted ? 'disabled' : ''}
                                           class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-base ${isCompleted || isSubmitted ? 'opacity-50' : ''}">
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="mb-8">
                        <h3 class="text-xl font-bold mb-4 text-primary">${round}</h3>
                        <div class="grid gap-4">
                            ${fixturesHtml}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('predictions-content').innerHTML = predictionsHtml || '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No fixtures available yet.</p>';
            
            updatePendingCount(selectedPlayer);
        }

        // Update pending count
        function updatePendingCount(playerId) {
            const pendingPredictions = predictions[playerId].pending;
            const count = Object.keys(pendingPredictions).length;
            
            const pendingCountEl = document.getElementById('pending-count');
            const pendingNumberEl = document.getElementById('pending-number');
            const submitBtn = document.getElementById('submit-predictions-btn');
            
            if (count > 0) {
                pendingCountEl.classList.remove('hidden');
                submitBtn.classList.remove('hidden');
                pendingNumberEl.textContent = count;
            } else {
                pendingCountEl.classList.add('hidden');
                submitBtn.classList.add('hidden');
            }
        }

        // Update prediction (save to pending)
        function updatePrediction(playerId, fixtureId, scoreType, value) {
            if (!predictions[playerId].pending[fixtureId]) {
                predictions[playerId].pending[fixtureId] = {};
            }
            
            predictions[playerId].pending[fixtureId][scoreType] = value;
            
            const prediction = predictions[playerId].pending[fixtureId];
            if (!prediction.homeScore || !prediction.awayScore) {
                return;
            }
            
            saveToStorage();
            updatePendingCount(playerId);
        }

        // Submit pending predictions
        function submitPendingPredictions() {
            const selectedPlayer = document.getElementById('player-select').value;
            const pending = predictions[selectedPlayer].pending;
            
            let submittedCount = 0;
            Object.keys(pending).forEach(fixtureId => {
                const prediction = pending[fixtureId];
                if (prediction.homeScore && prediction.awayScore) {
                    predictions[selectedPlayer].submitted[fixtureId] = { ...prediction };
                    submittedCount++;
                }
            });
            
            predictions[selectedPlayer].pending = {};
            
            saveToStorage();
            updatePredictionsView();
            
            showToast(`‚úÖ ${submittedCount} prediction${submittedCount !== 1 ? 's' : ''} submitted successfully!`, 'success');
        }

        // Update fixtures view
        function updateFixturesView() {
            const fixturesHtml = fixtures.map(fixture => `
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between">
                        <div>
                            <div class="font-bold text-lg">${fixture.homeTeam} vs ${fixture.awayTeam}</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">
                                ${fixture.round} ‚Ä¢ ${new Date(fixture.date).toLocaleDateString()}
                                ${fixture.completed ? ' ‚Ä¢ COMPLETED' : ''}
                            </div>
                        </div>
                        <button onclick="removeFixture(${fixture.id})" 
                                class="mt-2 sm:mt-0 bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                            Remove
                        </button>
                    </div>
                </div>
            `).join('');

            document.getElementById('fixtures-content').innerHTML = fixturesHtml || '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No fixtures added yet.</p>';
        }

        // Update results view
        function updateResultsView() {
            const resultsHtml = fixtures.filter(f => !f.completed).map(fixture => `
                <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
                    <div class="font-bold text-lg mb-3">${fixture.homeTeam} vs ${fixture.awayTeam}</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400 mb-4">${fixture.round} ‚Ä¢ ${new Date(fixture.date).toLocaleDateString()}</div>
                    
                    <div class="flex space-x-4 items-end">
                        <div class="flex-1">
                            <label class="block text-sm font-medium mb-1">${fixture.homeTeam} Score</label>
                            <input type="number" min="0" max="100" id="result-home-${fixture.id}" 
                                   class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-base">
                        </div>
                        <div class="text-xl font-bold pb-2">-</div>
                        <div class="flex-1">
                            <label class="block text-sm font-medium mb-1">${fixture.awayTeam} Score</label>
                            <input type="number" min="0" max="100" id="result-away-${fixture.id}" 
                                   class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-800 text-base">
                        </div>
                        <button onclick="saveResult(${fixture.id})" 
                                class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded font-medium">
                            Save Result
                        </button>
                    </div>
                </div>
            `).join('');

            document.getElementById('results-content').innerHTML = resultsHtml || '<p class="text-gray-500 dark:text-gray-400 text-center py-8">All fixtures completed!</p>';
        }

        // Add fixture modal functions
        function addFixture() {
            const homeSelect = document.getElementById('home-team');
            const awaySelect = document.getElementById('away-team');
            
            const teamOptions = teams.map(team => `<option value="${team}">${team}</option>`).join('');
            homeSelect.innerHTML = teamOptions;
            awaySelect.innerHTML = teamOptions;
            
            document.getElementById('match-date').valueAsDate = new Date();
            
            document.getElementById('fixture-modal').classList.remove('hidden');
            document.getElementById('fixture-modal').classList.add('flex');
        }

        function closeFixtureModal() {
            document.getElementById('fixture-modal').classList.add('hidden');
            document.getElementById('fixture-modal').classList.remove('flex');
        }

        function saveFixture() {
            const homeTeam = document.getElementById('home-team').value;
            const awayTeam = document.getElementById('away-team').value;
            const matchDate = document.getElementById('match-date').value;
            const matchRound = document.getElementById('match-round').value || 'Other';

            if (homeTeam === awayTeam) {
                showToast('‚ö†Ô∏è Please select different teams', 'error');
                return;
            }

            const newFixture = {
                id: Date.now(),
                homeTeam,
                awayTeam,
                date: matchDate,
                round: matchRound,
                completed: false
            };

            fixtures.push(newFixture);
            saveToStorage();
            closeFixtureModal();
            updateFixturesView();
            showToast('‚úÖ Fixture added successfully!', 'success');
        }

        function removeFixture(fixtureId) {
            showConfirmDialog('Are you sure you want to remove this fixture? This will also remove all predictions and results for this match.', () => {
                fixtures = fixtures.filter(f => f.id !== fixtureId);
                
                Object.keys(predictions).forEach(playerId => {
                    delete predictions[playerId].submitted[fixtureId];
                    delete predictions[playerId].pending[fixtureId];
                });
                delete results[fixtureId];
                
                saveToStorage();
                updateFixturesView();
                showToast('‚úÖ Fixture removed', 'success');
            });
        }

        function saveResult(fixtureId) {
            const homeScore = document.getElementById(`result-home-${fixtureId}`).value;
            const awayScore = document.getElementById(`result-away-${fixtureId}`).value;

            if (homeScore === '' || awayScore === '') {
                showToast('‚ö†Ô∏è Please enter both scores', 'error');
                return;
            }

            results[fixtureId] = {
                homeScore: parseInt(homeScore),
                awayScore: parseInt(awayScore)
            };

            const fixture = fixtures.find(f => f.id === fixtureId);
            if (fixture) fixture.completed = true;

            saveToStorage();
            showToast('‚úÖ Result saved successfully!', 'success');
            updateResultsView();
            updateLeaderboard();
        }

        function resetAllData() {
            showConfirmDialog('Are you sure you want to reset all data? This will remove all fixtures, predictions, and results.', () => {
                fixtures = [];
                predictions = {
                    player1: { submitted: {}, pending: {} },
                    player2: { submitted: {}, pending: {} },
                    player3: { submitted: {}, pending: {} }
                };
                results = {};
                
                saveToStorage();
                updateFixturesView();
                updatePredictionsView();
                updateResultsView();
                updateLeaderboard();
                
                showToast('‚úÖ All data has been reset', 'success');
            });
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            toast.className = `toast ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Confirm dialog
        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancel</button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Confirm</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            modal.querySelector('.cancel-btn').addEventListener('click', () => modal.remove());
            modal.querySelector('.confirm-btn').addEventListener('click', () => {
                modal.remove();
                onConfirm();
            });
        }

        // Player selection change
        document.getElementById('player-select').addEventListener('change', updatePredictionsView);

        // Initialize the app
        if (!loadFromStorage()) {
            initializeSampleData();
        }
        showTab('leaderboard');
    </script>
</body>
</html>
